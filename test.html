<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>jsShell.js manual test</title>
  <style>
      .customized-line {
          font-weight: bold;
          background-color: #ff9292;
          color: black;
      }

      #restart-btn {
          display: none;
      }
  </style>
</head>
<body>
<h1>jsShell.js manual test suite</h1>
<div id="shell-1"></div>
<div id="shell-2-container"></div>
<div id="shell-3"></div>
<div id="shell-4"></div>
<button id="restart-btn" onclick="startTestSuite()">Restart test suite</button>
<br/>
<br/>

<script type="module">
  import { JsShell } from "./jsShell.js";

  const startTestSuite = async () => {
    let t2Container = document.getElementById("shell-2-container")
    t2Container.innerHTML = '';
    let restartBtn = document.getElementById('restart-btn');
    restartBtn.style.display = 'none';

    let t1 = new JsShell("shell-1")
    window.t1 = t1;
    t1.setHeight("100px")
      .setWidth('600px')
      .print(`Hello, world! I'm shell-1`)
      .setPrompt('> ');

    let name = await t1.input('Whats your name?');

    t1.print(`Welcome, ${name}`)

    let t3 = new JsShell('shell-3', {
      height: '150px',
      width: '550px',
      backgroundColor: '#f1f2f5',
      textColor: 'black',
    }).setVisible(false);

    let t2Element = document.createElement('div');
    t2Element.id = "shell-2"
    let t2 = new JsShell(t2Element)
    t2.setHeight("150px")
      .setWidth('650px')
      .setBackgroundColor('blue')

    t2Container.appendChild(t2.html);
    t2.print('Hello again! I\'m shell-2.')
      .print("I'll ask you a few tasks to ensure the module is still working fine.");

    await t2.pause('PRESS ANY KEY IF THAT\'S OK FOR YOU');

    t2.print(`Great!`);
    await t2.type("I can write...");
    await JsShell.sleep(500);
    await t2.type('on a single line. ');
    await JsShell.sleep(500);
    t2.write("Cool isn't it?")
    await JsShell.sleep(500);
    t2.newLine()
      .newLine()
      .print("But also break a few lines")
      .newLine()
      .newLine()
      .newLine()
      .print("Impressive.. uh?");

    await JsShell.sleep(500);

    t3.setVisible(true)
      .print("Hi, I'm shell-3.")
      .printHTML("<strong class='customized-line'>Here's a customized HTML tag.</strong>")
      .printHTML("<a href='https://github.com/francoisburdy/js-shell-emulator'>Github Link</a>");

    let password = await t3.password("Enter password (a fake one! I'll display it):");

    t3.print(`Your password is: ${password}`)
      .print('Please go back to shell-2');

    t2.clear()
      .focus()
      .setPrompt('> ')
    await t2.expect(['next'], 'type "next" please', 'try again');

    t2.print('thanks');

    let t4 = new JsShell('shell-4', {
      fontFamily: 'monospace',
      cursorType: 'thin',
      cursorSpeed: 400,
    })

    t4.setHeight("180px")
      .setWidth('700px')
      .setBackgroundColor('darkblue')
      .print("Hi, I'm shell-4")
      .setPrompt('$ ');

    await t4.expect(
      ['done', 'stop'],
      'I expect you to type any command that <strong>IS NOT</strong> "done" or "stop", multiple times. Can you do that?',
      'Thank you. You can do that again, or use "stop" to proceed.'
    )

    t4.clear()
      .setBackgroundColor("#ffc700")
      .setTextColor("black")
      .print("Thanks!")
      .setPrompt('> ');

    let didConfirm = await t4.confirm("Now check the DevTools console, there should be no JavaScript error. Is that ok?")

    if (didConfirm) {
      t4.setBackgroundColor("#00c142")
        .setTextSize("1.5em")
        .clear()
        .print("Amazing! Tests passed. Good bye!")
    } else {
      t4.setBackgroundColor('red')
        .setTextColor("white")
        .printHTML("<strong>Damned...would you please open an issue on the <a href='https://github.com/francoisburdy/js-shell-emulator'>GitHub repo</a>?</strong>")
    }
    restartBtn.style.display = 'block';
  }

  window.startTestSuite = startTestSuite;
  startTestSuite()
</script>
</body>
</html>
